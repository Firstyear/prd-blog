<!DOCTYPE html>
<html lang="en">
    <head>
        
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <meta name="description" content="Firstyear&#x27;s blog">
        

        <title>Firstyear&#x27;s blog-a-log</title>

        
          <link rel="alternate" type="application/rss+xml" title="RSS" href="https://fy.blackhats.net.au/rss.xml">
        

        
            <link rel="stylesheet" href="https://fy.blackhats.net.au/theme.css">
        
        
    </head>
    <body>
        <div class="content">
        
        
            <header>
                <div class="header-left">
                    <a href="https:&#x2F;&#x2F;fy.blackhats.net.au" class="logo">Firstyear&#x27;s blog-a-log</a>
                </div>
                <div class="header-right">
                    <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
                      <ul>
                        
                        
                            
                            <li class="nav">
                                <a itemprop="url" href="https://fy.blackhats.net.au/blog/">
                                    <span itemprop="name">Blog</span>
                                </a>
                            </li>
                        
                            
                            <li class="nav">
                                <a itemprop="url" href="https://fy.blackhats.net.au/pages/">
                                    <span itemprop="name">Pages</span>
                                </a>
                            </li>
                        
                        
                        <li class="nav">
                            <a itemprop="url" href="https://github.com/firstyear">
                                <img class="icon" src="https:&#x2F;&#x2F;fy.blackhats.net.au/icons/github.svg" alt="Github">
                            </a>
                        </li>
                        
                        <li class="nav">
                            <a itemprop="url" href="/rss.xml">
                                <img class="icon" src="https:&#x2F;&#x2F;fy.blackhats.net.au/rss-logo.png" alt="rss">
                            </a>
                        </li>
                      </ul>
                    </nav>
                </div>
            </header>
        
        
        <main>
            
<article itemscope itemtype="http://schema.org/BlogPosting">
    <div itemprop="headline">
        <h1>Magic script for post install interface configuration</h1>
        <div class="border"></div>
        <time datetime="2015-11-26" class="date" itemprop="datePublished">
            26 Nov 2015
        </time>
    </div>
    <div itemprop="articleBody">
        <h1 id="magic-script-for-post-install-interface-configuration">Magic script for post install interface configuration</h1>
<p>Generally on a network we can't always trust dhcp or rtadvd to be there
for servers.</p>
<p>So here is a magic script that will generate an ifcfg based on these
parameters when the server first runs. It helps if you register off the
mac to a dhcp entry too.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>DEV=$(ip route | grep ^default | sed &#39;s/^.* dev //;s/ .*$//&#39;|head -1)
</span><span>if [ -n &quot;$DEV&quot; ]
</span><span>then
</span><span>     IP_AND_PREFIX_LEN=$(ip -f inet addr show dev $DEV | grep &#39;inet &#39;| head -1 | sed &#39;s/^ *inet *//;s/ .*$//&#39;)
</span><span>     IP=$(echo ${IP_AND_PREFIX_LEN} | cut -f1 -d&#39;/&#39;)
</span><span>     MASK=$(ipcalc -m ${IP_AND_PREFIX_LEN} | sed &#39;s/^.*=//&#39;)
</span><span>     GW=$(ip route | grep default | head -1 | sed &#39;s/^.*via //;s/ .*$//&#39;)
</span><span>     IP6_PREFIX=$(ip -f inet6 addr show dev $DEV | grep &#39;inet6 &#39;| head -1 | sed &#39;s/^ *inet6 *//;s/ .*$//&#39;)
</span><span>     IP6=$(echo ${IP6_PREFIX} | cut -f1 -d&#39;/&#39;)
</span><span>     MASK6=$(echo ${IP6_PREFIX} | cut -f2 -d&#39;/&#39;)
</span><span>     GW6=$(ip -6 route | grep default | head -1 | sed &#39;s/^.*via //;s/ .*$//&#39;)
</span><span>     MAC=$(ip link show dev ${DEV} | grep &#39;link/ether &#39;| head -1 | sed &#39;s/^ *link\/ether *//;s/ .*$//&#39;)
</span><span>
</span><span>cat &gt; /etc/sysconfig/network-scripts/ifcfg-${DEV} &lt;&lt; DEVEOF
</span><span># Generated by magic
</span><span>DEVICE=${DEV}
</span><span>ONBOOT=yes
</span><span>NETBOOT=no
</span><span>BOOTPROTO=static
</span><span>TYPE=Ethernet
</span><span>NAME=${DEV}
</span><span>DEFROUTE=yes
</span><span>IPV4_FAILURE_FATAL=yes
</span><span>IPV6_FAILURE_FATAL=yes
</span><span>IPV6INIT=yes
</span><span>PEERDNS=no
</span><span>PEERROUTES=no
</span><span>IPV6_AUTOCONF=no
</span><span>HWADDR=${MAC}
</span><span>IPADDR=${IP}
</span><span>GATEWAY=${GW}
</span><span>NETMASK=${MASK}
</span><span>IPV6ADDR=${IP6}
</span><span>#PREFIX=${MASK6}
</span><span>IPV6_DEFAULTGW=${GW6}
</span><span>DNS1=PUT YOUR DNS SERVER IP HERE
</span><span>DNS2=PUT YOUR DNS SERVER IP HERE
</span><span>#NM_CONTROLLED=no
</span><span>
</span><span>DEVEOF
</span><span>
</span><span>    #Done
</span><span>fi
</span></code></pre>

    </div>
</article>

        </main>
        
        <footer>
            
            <div class="border"></div>
            <div class="footer">
                <small class="footer-left">
                    Copyright &copy; William Brown
                </small>
                <small class="footer-right">
                    Powered by <a href="https://www.getzola.org">Zola</a> | Theme <a href="https://github.com/barlog-m/oceanic-zen">Oceanic Zen</a>
                </small>
            </div>
        
        </footer>
    
        </div>
    </body>
</html>
